---
const { active = '' } = Astro.props;
---
<header class="site-header" role="banner">
  <div class="header-progress" aria-hidden="true"><span></span></div>
  <div class="container">
  <a href="/" class="brand" aria-label="Research for Everyone home">
  <img src="/logo.png" alt="Research for Everyone logo" width="64" height="64" decoding="async" />
      <span>Research for Everyone</span>
    </a>
  <div class="spacer"></div>
  <nav class="nav" id="primary-nav" role="navigation" aria-label="Primary">
      <ul>
        <li><a href="/" class={active === 'home' ? 'active' : ''}>Home</a></li>
        <li><a href="/programs/details" class={active === 'details' ? 'active' : ''}>Details</a></li>
        <li><a href="/programs/admissions" class={active === 'admissions' ? 'active' : ''}>Admissions</a></li>
        <li><a href="/programs/projects" class={active === 'projects' ? 'active' : ''}>Projects</a></li>
        <li><a href="/programs/patents" class={active === 'patents' ? 'active' : ''}>Patents</a></li>
        <li><a href="/programs/staff" class={active === 'staff' ? 'active' : ''}>Staff</a></li>
        <li class="cta-pill"><a href="/programs/admissions" class="nav-cta">Apply now</a></li>
      </ul>
    </nav>
  <button class="nav-toggle" aria-label="Toggle navigation" aria-controls="primary-nav" aria-expanded="false">â˜°</button>
  </div>
</header>
<script>
// Header navigation toggle
document.addEventListener('DOMContentLoaded', () => {
  const nav = document.querySelector('.nav');
  const toggle = document.querySelector('.nav-toggle');
  const header = document.querySelector('.site-header');
  const progress = document.querySelector('.header-progress span');
  if (!nav || !toggle) return;
  toggle.addEventListener('click', () => {
    nav.classList.toggle('open');
    toggle.setAttribute('aria-expanded', nav.classList.contains('open').toString());
  });
  nav.addEventListener('click', (e) => {
  const target = e.target;
  if (target instanceof Element && target.tagName === 'A') {
      nav.classList.remove('open');
      toggle.setAttribute('aria-expanded', 'false');
    }
  });

  const handleScrollState = () => {
    if (header) header.classList.toggle('is-condensed', window.scrollY > 8);
    if (!progress) return;
    const doc = document.documentElement;
    const scrollable = doc.scrollHeight - window.innerHeight;
    const ratio = scrollable > 0 ? Math.min(1, window.scrollY / scrollable) : 0;
    progress.style.transform = `scaleX(${ratio})`;
    progress.style.opacity = ratio > 0 ? '1' : '0';
  };

  handleScrollState();
  window.addEventListener('scroll', handleScrollState, { passive: true });
});
</script>
<style>
/* Header and navigation styles */
.site-header {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(18px);
  border-bottom: 1px solid rgba(120, 144, 255, 0.15);
  transition: box-shadow 0.3s ease, transform 0.3s ease;
}

.site-header .container {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  padding: 14px 0;
  position: relative;
}

.site-header.is-condensed {
  box-shadow: 0 20px 45px rgba(15, 23, 42, 0.15);
  transform: translateY(-2px);
}

.site-header.is-condensed .container { padding: 10px 0; }

.header-progress {
  position: absolute;
  inset: auto 0 0 0;
  height: 2px;
  background: rgba(147, 197, 253, 0.3);
  overflow: hidden;
}

.header-progress span {
  display: block;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, #4CC9F0, #4361EE);
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.2s ease;
}

.brand {
  display: flex;
  align-items: center;
  gap: 8px;
  pointer-events: auto; /* be extra explicit */
}

.brand { color: inherit; text-decoration: none; }

.brand img { width: 64px; height: 64px; }
.brand span { font-weight: 700; font-size: 1.125rem; color: var(--ink-900); }

.spacer { flex: 1 1 auto; }
.nav-toggle { display: none !important; margin-left: auto; }

.nav ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  gap: 24px;
}

.nav a {
  position: relative;
  padding-bottom: 4px;
  color: var(--ink-700);
  font-weight: 500;
}

.nav a:hover, .nav a.active { color: var(--ink-900); }

.nav a::after {
  content: '';
  position: absolute;
  left: 0; right: 0; bottom: -2px;
  height: 2px; background: var(--p-600);
  transform: scaleX(0);
  transform-origin: left;
  transition: transform .2s ease;
}
.nav a:hover::after, .nav a.active::after { transform: scaleX(1); }

.cta-pill { margin-left: 8px; }
.nav-cta {
  padding: 10px 18px;
  border-radius: 999px;
  background: linear-gradient(120deg, #4CC9F0, #4361EE);
  color: #fff !important;
  font-weight: 600;
  border: none;
}
.nav-cta::after { display: none; }
.nav-cta:hover { opacity: 0.9; }

@media (max-width: 768px) {
  .site-header .container { padding: 10px 0; }
  .brand img { width: 44px; height: 44px; }
  .brand span { font-size: 1rem; }
  .nav ul {
    display: none;
    position: absolute;
    right: 16px; 
    top: calc(100% + 12px);
    background: var(--bg-0);
    border: 1px solid var(--line-200);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: var(--shadow);
    flex-direction: column;
    gap: 12px;
  }
  .nav.open ul { display: flex; }
  .nav-toggle {
    display: inline-flex !important;
    background: var(--p-600);
    color: #fff;
    border: none;
    padding: 8px 12px;
    border-radius: var(--radius);
    cursor: pointer;
  }
  .cta-pill { width: 100%; }
  .nav-cta { display: inline-flex; justify-content: center; width: 100%; }
}
</style>
