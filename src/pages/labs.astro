---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Hero from '../components/Hero.astro';
---
<BaseLayout title="Labs & Universities | Research for Everyone" description="Partner with us: risk controls, insurance, economics and how to apply.">
  <Header active="labs" />
  <main>
    <Hero
      title="Partner with us"
      subtitle="Off-peak revenue on idle capacity. Pre-trained visitors. Supervision and admin handled."
      primaryCta={{ text: 'Apply to Partner', href: '#partner-form' }}
    />
    <section id="partner-form" class="reveal">
      <div class="container">
        <h2>Apply to Partner</h2>
        <p class="sub">Tell us about your lab; we’ll be in touch.</p>
    <form class="ajax-form" data-form-endpoint="https://formspree.io/f/mzzvqeyk" style="max-width:600px;margin-top:24px;">
          <div style="display:flex;flex-direction:column;gap:12px;">
            <input type="text" name="orgName" placeholder="Organization name" required style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);" />
            <input type="text" name="contact" placeholder="Lab manager contact (name & email)" required style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);" />
            <input type="text" name="address" placeholder="Address" required style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);" />
            <input type="number" name="maxCapacity" placeholder="Max capacity" min="1" style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);" />
      <input type="text" name="company" tabindex="-1" autocomplete="off" style="position:absolute;left:-5000px;opacity:0;" aria-hidden="true" />
            <button type="submit" class="btn primary" style="width:fit-content;">Submit application</button>
            <div class="form-status" aria-live="polite" style="font-size:0.95rem;color:var(--ink-500);"></div>
          </div>
        </form>
        <script is:inline>
        // Prevent redirect; submit via fetch and show inline status
        (function(init){
          if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init, { once: true });
          else init();
        })(() => {
          const form = document.querySelector('#partner-form form.ajax-form');
          if (!form) return;
          const status = form.querySelector('.form-status');
          const endpoint = form.getAttribute('data-form-endpoint') || '';
          const honeypot = form.querySelector('input[name="company"]');
          form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (honeypot && honeypot.value) { if (status) status.textContent = 'Thanks!'; form.reset(); return; }
            if (!endpoint) { if (status) status.textContent = 'Thanks! Your message was captured locally.'; form.reset(); return; }
            const formData = new FormData(form);
            if (status) { status.style.color = 'var(--ink-500)'; status.textContent = 'Sending…'; }
            fetch(endpoint, { method: 'POST', body: formData, headers: { 'Accept': 'application/json' } })
            .then((res) => {
              if (res.ok) { if (status) { status.style.color = 'var(--p-600)'; status.textContent = 'Thank you! We\'ll be in touch.'; } form.reset(); }
              else { return res.json().catch(() => ({})).then((data) => { throw new Error(data.error || 'Submission failed.'); }); }
            })
            .catch((err) => { if (status) { status.style.color = '#b00020'; status.textContent = 'Oops, something went wrong. Please email Omar.2123039@stemobour.moe.edu.eg'; } console.error(err); });
          });
  });
        </script>
      </div>
    </section>
  </main>
  <Footer />
</BaseLayout>
