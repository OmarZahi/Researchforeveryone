---
import GoogleLayout from '../layouts/GoogleLayout.astro';
import MotionWrapper from '../components/animations/MotionWrapper.astro';
---

<GoogleLayout title="Labs & Universities | Research for Everyone" description="Partner with us: risk controls, insurance, economics and how to apply.">
  <div class="max-w-7xl mx-auto px-6">
    <section class="py-24">
      <MotionWrapper animation="fade-up">
        <h1 class="text-5xl md:text-7xl font-medium tracking-tight text-gray-900 mb-8">
          Partner with us
        </h1>
        <p class="text-xl md:text-2xl text-gray-600 max-w-3xl leading-relaxed mb-12">
          Off-peak revenue on idle capacity. Pre-trained visitors. Supervision and admin handled.
        </p>
        <a href="#partner-form" class="bg-blue-600 text-white px-8 py-4 rounded-full text-lg font-medium hover:bg-blue-700 transition-colors inline-block">
          Apply to Partner
        </a>
      </MotionWrapper>
    </section>

    <section id="partner-form" class="py-24 border-t border-gray-100">
      <div class="max-w-2xl">
        <MotionWrapper animation="fade-up">
          <h2 class="text-3xl md:text-4xl font-medium text-gray-900 mb-6">Apply to Partner</h2>
          <p class="text-lg text-gray-600 mb-12">Tell us about your lab; we’ll be in touch.</p>
          
          <form class="ajax-form space-y-6" data-form-endpoint="https://formspree.io/f/mzzvqeyk">
            <div>
              <input type="text" name="orgName" placeholder="Organization name" required class="w-full p-4 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all" />
            </div>
            <div>
              <input type="text" name="contact" placeholder="Lab manager contact (name & email)" required class="w-full p-4 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all" />
            </div>
            <div>
              <input type="text" name="address" placeholder="Address" required class="w-full p-4 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all" />
            </div>
            <div>
              <input type="number" name="maxCapacity" placeholder="Max capacity" min="1" class="w-full p-4 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all" />
            </div>
            <input type="text" name="company" tabindex="-1" autocomplete="off" class="hidden" aria-hidden="true" />
            
            <button type="submit" class="bg-gray-900 text-white px-8 py-4 rounded-full text-lg font-medium hover:bg-gray-800 transition-colors w-full md:w-auto">
              Submit application
            </button>
            <div class="form-status text-sm text-gray-500 mt-4" aria-live="polite"></div>
          </form>
        </MotionWrapper>
      </div>
    </section>
  </div>

  <script is:inline>
    // Prevent redirect; submit via fetch and show inline status
    (function(init){
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init, { once: true });
      else init();
    })(() => {
      const form = document.querySelector('#partner-form form.ajax-form');
      if (!form) return;
      const status = form.querySelector('.form-status');
      const endpoint = form.getAttribute('data-form-endpoint') || '';
      const honeypot = form.querySelector('input[name="company"]');
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        if (honeypot && honeypot.value) { if (status) status.textContent = 'Thanks!'; form.reset(); return; }
        if (!endpoint) { if (status) status.textContent = 'Thanks! Your message was captured locally.'; form.reset(); return; }
        const formData = new FormData(form);
        if (status) { status.style.color = '#6b7280'; status.textContent = 'Sending…'; }
        fetch(endpoint, { method: 'POST', body: formData, headers: { 'Accept': 'application/json' } })
        .then((res) => {
          if (res.ok) { if (status) { status.style.color = '#2563eb'; status.textContent = 'Thank you! We\'ll be in touch.'; } form.reset(); }
          else { return res.json().catch(() => ({})).then((data) => { throw new Error(data.error || 'Submission failed.'); }); }
        })
        .catch((err) => { if (status) { status.style.color = '#dc2626'; status.textContent = 'Oops, something went wrong. Please email Omar.2123039@stemobour.moe.edu.eg'; } console.error(err); });
      });
    });
  </script>
</GoogleLayout>
