---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Hero from '../components/Hero.astro';
---
<BaseLayout title="Lab Readiness Passport | Research for Everyone" description="Learn about the Passport safety course: modules, assessment and consent requirements.">
  <Header active="passport" />
  <main>
    <Hero
      title="Earn your Lab Readiness Passport"
      subtitle="Standardized safety training and assessment to earn your badge for supervised access to real labs."
      primaryCta={{ text: 'Enroll now', href: '#enroll' }}
    />

    <section class="reveal">
      <div class="container">
        <div class="features">
          <div class="feature">
            <h3>Modules</h3>
            <p>General lab safety (PPE, signage, housekeeping, emergencies), BSL‑1 biosafety basics, basic electrical and mechanical safety for fabrication tools, code of conduct & harassment prevention, waste disposal and incident reporting.</p>
          </div>
          <div class="feature">
            <h3>Assessment</h3>
            <p>A mix of multiple‑choice questions and hands‑on demonstration. Badges are valid for 12 months and may be revoked for safety violations.</p>
          </div>
          <div class="feature">
            <h3>Parental consent</h3>
            <p>Participants under 18 require a guardian to sign the consent and waiver forms. A named chaperone must accompany the minor during sessions.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="enroll" class="reveal">
      <div class="container">
        <h2>Enroll in Passport</h2>
        <p class="sub">Sign up for the next safety class. We will confirm dates and logistics by email.</p>
        <form class="ajax-form" data-form-endpoint="https://formspree.io/f/mzzvqeyk" style="max-width:500px;margin-top:24px;">
          <div style="display:flex;flex-direction:column;gap:12px;">
            <input type="text" name="fullName" placeholder="Your full name" autocomplete="name" required style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);" />
            <input type="email" name="email" placeholder="Your email" autocomplete="email" required style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);" />
            <input type="text" name="school" placeholder="School/University" style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);" />
            <input type="text" name="age" placeholder="Age" inputmode="numeric" style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);" />
            <textarea name="notes" placeholder="Accessibility needs or questions" rows="3" style="padding:12px;border-radius:var(--radius);border:1px solid var(--line-200);"></textarea>
            <input type="text" name="company" tabindex="-1" autocomplete="off" style="position:absolute;left:-5000px;opacity:0;" aria-hidden="true" />
            <button type="submit" class="btn primary" style="width:fit-content;">Submit registration</button>
            <div class="form-status" aria-live="polite" style="font-size:0.95rem;color:var(--ink-500);"></div>
          </div>
        </form>
        <script is:inline>
        (function(init){
          if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init, { once: true });
          else init();
        })(() => {
          const form = document.querySelector('#enroll form.ajax-form, #enroll form');
          if (!form) return;
          // Ensure data attributes exist in case of future edits
          if (!form.classList.contains('ajax-form')) form.classList.add('ajax-form');
          if (!form.getAttribute('data-form-endpoint')) form.setAttribute('data-form-endpoint', 'https://formspree.io/f/mzzvqeyk');
          if (!form.querySelector('.form-status')) {
            const statusDiv = document.createElement('div');
            statusDiv.className = 'form-status';
            statusDiv.setAttribute('aria-live', 'polite');
            statusDiv.style.fontSize = '0.95rem';
            statusDiv.style.color = 'var(--ink-500)';
            form.appendChild(statusDiv);
          }
          const status = form.querySelector('.form-status');
          const endpoint = form.getAttribute('data-form-endpoint') || '';
          const honeypot = form.querySelector('input[name="company"]');
          form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (honeypot && honeypot.value) { if (status) status.textContent = 'Thanks!'; form.reset(); return; }
            if (!endpoint) { if (status) status.textContent = 'Thanks! Your message was captured locally.'; form.reset(); return; }
            const formData = new FormData(form);
            if (status) { status.style.color = 'var(--ink-500)'; status.textContent = 'Sending…'; }
            fetch(endpoint, { method: 'POST', body: formData, headers: { 'Accept': 'application/json' } })
            .then((res) => {
              if (res.ok) { if (status) { status.style.color = 'var(--p-600)'; status.textContent = 'Thank you! We\'ll be in touch.'; } form.reset(); }
              else { return res.json().catch(() => ({})).then((data) => { throw new Error(data.error || 'Submission failed.'); }); }
            })
            .catch((err) => { if (status) { status.style.color = '#b00020'; status.textContent = 'Oops, something went wrong. Please email Omar.2123039@stemobour.moe.edu.eg'; } console.error(err); });
          });
  });
        </script>
      </div>
    </section>

    <script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "Course",
      "name": "Lab Readiness Passport",
      "description": "A 3–4 hour safety course covering general lab safety, BSL‑1 biosafety and basic fabrication tools. Pass the exam to earn a 12‑month badge.",
      "provider": { "@type": "Organization", "name": "Research for Everyone", "sameAs": "https://researchforeveryone.org" }
    }</script>
  </main>
  <Footer />
</BaseLayout>
